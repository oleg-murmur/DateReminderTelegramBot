(()=>{"use strict";const e=document.getElementById("addButton"),t=document.getElementById("viewButton"),n=document.getElementById("addEventForm"),i=document.getElementById("saveEventButton"),a=document.getElementById("eventsContainer"),d=document.getElementById("eventDate"),s=document.getElementById("eventName"),o=document.getElementById("unSaveEventButton"),c=window.Telegram.WebApp;let l=[];document.addEventListener("click",(function(e){if(e.target&&"deleteEventButton"===e.target.id){const t=e.target.getAttribute("value");console.log(t),async function(e){if(e){const t=document.getElementById(e);t.style.display="none",setTimeout((()=>{t.remove()}),2e3),console.log(e);const n={id:e};try{await fetch("http://localhost:3000/api/reminders/delete",{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(n)})}catch(e){}}}(t)}}));const r=async()=>{try{await fetch(`http://localhost:3000/api/reminders/getbyuser?chatId=${c.initDataUnsafe?.user?.id}`).then((e=>e.json())).then((e=>{console.log(e),l=e})).then((()=>function(){if(a.innerHTML="",l.length<=0){const e=document.createElement("div");c.initDataUnsafe?.user?.username?e.innerHTML='<div>Пока события не добавлено. Нажмите "Добавить событие"</div>':e.innerHTML="<div>Вы не авторизованы</div>",a.appendChild(e)}else l.forEach((e=>{const t=document.createElement("div");t.id=e.id,console.log(e),t.innerHTML=`\n            <div id="event-item">\n                <div class="remindeText">${e.remindeText}</div>\n                <div class="remindeDate">${e.remindeDate}</div>\n                <button id="deleteEventButton" value="${e.id}" >Удалить</button>\n                </div>\n                `,a.appendChild(t)}))}()))}catch(e){console.log(e)}};t.addEventListener("click",(()=>{if(c.initDataUnsafe?.user?.username)r();else{a.innerHTML="";const e=document.createElement("div");e.innerHTML="<div>Данные не загружены</div>",a.appendChild(e)}})),r(),e.addEventListener("click",(()=>{n.classList.toggle("hidden")})),o.addEventListener("click",(()=>{n.classList.toggle("hidden"),d.value="",s.value=""})),i.addEventListener("click",(()=>{const e={chatId:c.initDataUnsafe?.user?.id||"not auth",userId:c.initDataUnsafe?.user?.username,date:d.value,eventName:s.value,another_info:JSON.stringify(c)};if(c.initDataUnsafe?.user?.id&&c.initDataUnsafe?.user?.username)try{(async e=>{await fetch("http://localhost:3000/api/reminders/create",{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(e)})})(e)}catch(e){console.log(e)}else console.log("ошибка");l.push(e),n.classList.add("hidden"),d.value="",s.value=""}))})();